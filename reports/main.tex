\input{$UNI_DIR/msc/tex/HWSetup}
\input{$UNI_DIR/msc/tex/EngBindings}

%
% Homework Details
%   - Title
%   - Subtitle
%   - Due date
%   - Due time
%   - Course
%   - Section/Time
%   - Instructor
%   - Author
%

\hwkTitle{HW05}
\hwkSubTitle{State Estimation}
\hwkDueDate{2025-12-04}
\hwkDueTime{09:30:00}
\hwkClass{ENAE 441 - 0101}
\hwkClassTime{09:30:00}
\hwkInstructor{Dr. Martin}
\hwkAuthor{Vai Srivastava}
\hwkCompletionDate{\today}

\begin{document}

\maketitle

\pagebreak

% 1a and 3a are written solutions, everything else is coding

\begin{hwkProblem}{1}{Batch Least Squares Estimation \textit{(30 pts.)}} \label{hwk:p01}

	Imagine there is a spacecraft flying in a circular geosynchronous orbit around the Earth. To an observer on the rotating Earth, the spacecraft location appears static. You do not know the exact semi-major axis, but you can estimate it using a range measurement taken from a radio on the ground.
	\[
		\rho = \sqrt{x^{2} + y^{2} + z^{2}}
	\]
	Assume you are positioned directly beneath the satellite such that range measurement can be reduced to the following form:
	\[
		\rho = \sqrt{z^{2}} = z
	\]
	For \textbf{50} consecutive nights, you go outside and point your radio antenna towards the spacecraft and collect 200 noisy range measurements. The radio antenna is not particularly precise, so it has continuous measurement noise properties \( \fn{\bm{\tilde{v}}}[t] \sim \fn{\mathcal{N}}[0, V] \) where \( V = \qty{100}{\m\squared} \). Use this information and the measurements provided in \mintinline{python}{HW5Measurements.npy}\footnote{The measurements provided are formatted as a \( N \times M \) array where \( N \) corresponds to the trial and \( M \) corresponds to the number of measurements per trial and the units are \textbf{meters}.} to answer the following questions:

	\begin{enumerate}[label=\alph*.]
		\item \label{hwk:p01a} Express the system in continuous time state-space form assuming a state of
			\[
				\bm{X} = \bvect{x, y, z, \dot{x}, \dot{y}, \dot{z}}^{T}
			\]
			and convert to a discrete time state-space model assuming \( \Delta t = \qty{10}{\s} \)
		\item \label{hwk:p01b} Use batch least squares algorithm\footnote{Hint: When you need to take a matrix inverse for BLLS and subsequent algorithms, use \mintinline{python}{np.linalg.pinv} rather than \mintinline{python}{np.linalg.inv} to avoid singularities.} to estimate the spacecraft state from the first trial in \mintinline{python}{HW5Measurements.npy}. Plot the estimated position as a function of \( k = \left\{ 1, \dots, 200 \right\} \) measurements.
		\item \label{hwk:p01c} Repeat the batch estimation process for all \textbf{50} trials included in \mintinline{python}{HW5Measurements.npy}, and plot the resulting state estimates as a function of \( k \) along side their \( \pm 3 \sigma \) error bounds\footnote{Recall that the diagonal elements of the state error covariance matrix yield \( \sigma_{i}^{2} \).}\footnote{The \mintinline{python}{matplotlib} function \mintinline{python}{plt.fill_between} can be useful for the \( \pm 3 \sigma \) bounds that center on the mean.}.
		\item \label{hwk:p01d} Using all 50 trials, plot histograms for each state estimate in \( \vech{x} \) after \( k \in \left\{ 10, 50, 200 \right\} \) measurements. Include the sample mean and error covariance for each distribution as annotations\footnote{Use \mintinline{python}{np.nanmean} and \mintinline{python}{np.nanstd} over all values for a particular k.}. Do these values make sense? Why?
		\item \label{hwk:p01e} Measure the average amount of time it takes to compute an estimate as a function of \( k \). Use Python's \mintinline{python}{time} library.
	\end{enumerate}

	\hwkSol{} \label{hwk:s01}

	\hwkPart{} \label{hwk:s01a}

	In matrix form:
	\[
		\fn{\bm{\dot{X}}}[t]=A_c \fn{\bm{X}}[t],
	\]
	with
	\[
		A_c=\left[\begin{array}{llllll}
				0 & 0 & 0 & 1 & 0 & 0 \\
				0 & 0 & 0 & 0 & 1 & 0 \\
				0 & 0 & 0 & 0 & 0 & 1 \\
				0 & 0 & 0 & 0 & 0 & 0 \\
				0 & 0 & 0 & 0 & 0 & 0 \\
				0 & 0 & 0 & 0 & 0 & 0
		\end{array}\right]
	\]

	Measurement model:
	\[
		\fn{\rho}[t] = H \fn{\bm{X}}[t] + \fn{\bm{\tilde{v}}}[t], \quad \fn{\bm{\tilde{v}}}[t] \sim \fn{\mathcal{N}}[0, V],
	\]
	with
	\[
		H=\left[\begin{array}{llllll}
				0 & 0 & 1 & 0 & 0 & 0
		\end{array}\right], \quad V=\qty{100}{\m\squared}
	\]

	The discrete state transition is:
	\[
		\bm{X}_{k+1}=\bm{\Phi} \bm{X}_k, \quad \bm{\Phi}=e^{A_c \Delta t}
	\]

	\( A_{c} \) has the structure of a constant-velocity model:
	\[
		\bm{\Phi}=\left[\begin{array}{cc}
				\mathcal{I}_{3 \times 3} & \Delta t \mathcal{I}_{3 \times 3} \\
				0_{3 \times 3} & \mathcal{I}_{3 \times 3}
				\end{array}\right]=\left[\begin{array}{cccccc}
				1 & 0 & 0 & \Delta t & 0 & 0 \\
				0 & 1 & 0 & 0 & \Delta t & 0 \\
				0 & 0 & 1 & 0 & 0 & \Delta t \\
				0 & 0 & 0 & 1 & 0 & 0 \\
				0 & 0 & 0 & 0 & 1 & 0 \\
				0 & 0 & 0 & 0 & 0 & 1
		\end{array}\right]
	\]

	Thus, the measurement equation in discrete time is:
	\[
		\boxed{\rho_k=H \bm{X}_k+v_k, \quad v_k \sim \fn{\mathcal{N}}[0, V], \quad V=\qty{100}{\m\squared}}
	\]

	\hwkPart{} \label{hwk:s01b}

	\begin{figure}[H] \label{fig:s01b}
		\begin{center}
			\includegraphics[width=0.45\textwidth]{./outputs/figures/s01b.png}
		\end{center}
		\caption{blah}
	\end{figure}
	
	\hwkPart{} \label{hwk:s01c}

	\begin{figure}[H] \label{fig:s01c}
		\begin{center}
			\includegraphics[width=0.45\textwidth]{./outputs/figures/s01c.png}
		\end{center}
		\caption{blah}
	\end{figure}

	\hwkPart{} \label{hwk:s01d}

	\begin{figure}[H] \label{fig:s01d}
		\begin{center}
			\begin{subfigure}{0.45\textwidth} \label{fig:s01d1}
				\includegraphics[width=\linewidth]{./outputs/figures/s01d1.png}
				\caption{blah}
			\end{subfigure}
			\\
			\begin{subfigure}{0.45\textwidth} \label{fig:s01d2}
				\includegraphics[width=\linewidth]{./outputs/figures/s01d2.png}
				\caption{blah}
			\end{subfigure}
			\hfill
			\begin{subfigure}{0.45\textwidth} \label{fig:s01d3}
				\includegraphics[width=\linewidth]{./outputs/figures/s01d3.png}
				\caption{blah}
			\end{subfigure}
		\end{center}
	\end{figure}

	\inputminted{python}{./outputs/text/s01d.txt}

	\hwkPart{} \label{hwk:s01e}

	\begin{figure}[H] \label{fig:s01e}
		\begin{center}
			\includegraphics[width=0.45\textwidth]{./outputs/figures/s01e.png}
		\end{center}
		\caption{blah}
	\end{figure}

	\hwkCode{} \label{code:s01}

	See the \href{https://www.github.com/vaisriv/enae441-hw05/blob/main/src/hw05.py#L1}{Python code} for this problem.

\end{hwkProblem}

\begin{hwkProblem}{2}{Recursive Least Squares Estimation \textit{(30 pts.)}} \label{hwk:p02}

	\begin{enumerate}[label=\alph*.]
		\item \label{hwk:p02a} Using the same dataset, implement the recursive least squares algorithm to estimate \( \vech{x} \). Use an initial estimate of:
			\[
				\vech{x}_{0} = \bvect{\qty{0}{\km}, \qty{0}{\km}, \qty{42e3}{\km}, \qty{0}{\km\per\s}, \qty{0}{\km\per\s}, \qty{0}{\km\per\s}}
			\]
			and a covariance of:
			\[
				P_{0} = \bvect{
					50 \cdot \mathbb{I}_{3 \times 3} \unit{\km\squared} & \bm{0}_{3 \times 3} \\
					\bm{0}_{3 \times 3} & 1 \cdot \mathbb{I}_{3 \times 3} \unit{\km\squared\per\s\squared}
				}
			\]
			Plot the state estimate for the 50 trials as a function of \( k \).
		\item \label{hwk:p02b} Plot the sample mean state estimate \( \mu_{k} \) across all trials and the \( \pm 3 \sigma \) error bounds around the estimate. Does this mirror the same plot in \hyperref[hwk:p01d]{Problem 1, Part D}? Why or why not?
		\item \label{hwk:p02c} Measure/plot the average amount of time it takes to perform each update from \( k = \left\{ 1, \dots, 200 \right\} \) and compare against the batch least squares estimator. Explain any differences.
	\end{enumerate}

	\hwkSol{} \label{hwk:s02}

	\hwkPart{} \label{hwk:s02a}

	\begin{figure}[H] \label{fig:s02a}
		\begin{center}
			\includegraphics[width=0.45\textwidth]{./outputs/figures/s02a.png}
		\end{center}
		\caption{blah}
	\end{figure}

	\hwkPart{} \label{hwk:s02b}

	\begin{figure}[H] \label{fig:s02b}
		\begin{center}
			\includegraphics[width=0.45\textwidth]{./outputs/figures/s02b.png}
		\end{center}
		\caption{blah}
	\end{figure}

	\inputminted{python}{./outputs/text/s02b.txt}
	
	\hwkPart{} \label{hwk:s02c}

	\begin{figure}[H] \label{fig:s02c}
		\begin{center}
			\includegraphics[width=0.45\textwidth]{./outputs/figures/s02c.png}
		\end{center}
		\caption{blah}
	\end{figure}

	\inputminted{python}{./outputs/text/s02c.txt}

	\hwkCode{} \label{code:s02}

	See the \href{https://www.github.com/vaisriv/enae441-hw05/blob/main/src/hw05.py#L1}{Python code} for this problem.

\end{hwkProblem}

\begin{hwkProblem}{3}{Kalman Filtering \textit{(40 pts.)}} \label{hwk:p03}

	% Intructions

	\hwkSol{} \label{hwk:s03}

	\hwkPart{} \label{hwk:s03a}

	Answer

	\hwkPart{} \label{hwk:s03b}

	\inputminted{python}{./outputs/text/s03b.txt}
	
	\hwkPart{} \label{hwk:s03c}

	\begin{figure}[H] \label{fig:s03c}
		\begin{center}
			\includegraphics[width=0.45\textwidth]{./outputs/figures/s03c.png}
		\end{center}
		\caption{blah}
	\end{figure}

	\hwkPart{} \label{hwk:s03d}

	\begin{figure}[H] \label{fig:s03d}
		\begin{center}
			\includegraphics[width=0.45\textwidth]{./outputs/figures/s03d.png}
		\end{center}
		\caption{blah}
	\end{figure}

	\hwkPart{} \label{hwk:s03e}

	\inputminted{python}{./outputs/text/s03e.txt}

	\hwkPart{} \label{hwk:s03f}

	\begin{figure}[H] \label{fig:s03f}
		\begin{center}
			\includegraphics[width=0.45\textwidth]{./outputs/figures/s03f.png}
		\end{center}
		\caption{blah}
	\end{figure}

	\inputminted{python}{./outputs/text/s03f.txt}

	\hwkCode{} \label{code:s03}

	See the \href{https://www.github.com/vaisriv/enae441-hw05/blob/main/src/hw05.py#L1}{Python code} for this problem.

\end{hwkProblem}

\end{document}
